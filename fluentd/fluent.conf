<source>
    @type forward
    port 24224
</source>

<filter es.**>
  @type parser
  format json
  key_name log
  reserve_data true
  #remove_key_name_field true
</filter>

# The first match will be used!!! don't use multiple match statements which overlap
<match es.**>
    @type elasticsearch
    # @log_level trace  # log everything that enters this match (if 'match **', that would be everything)
    # comma seperated list of hosts host1:port1,host2:port2 etc.
    host elasticsearch
    port 9200
	index_name fluentd.${tag}

    <buffer>
        flush_interval 1s
        flush_thread_count 2
    </buffer>
</match>

<match file.**>
    @type file
    path /fluentd/log/fluentd-test-output.log
    append true
    add_path_suffix false
    
    # With JSON
    # {"worker":0,"message":"fluentd worker is now running worker=0","tag":"fluent.info","date":"2019-10-24 14:02:24"}
    # No JSON:
    # 2019-10-24T13:46:18+00:00       fluent.info     {"worker":0,"message":"fluentd worker is now running worker=0","tag":"fluent.info","date":"2019-10-24 13:46:18"}        
    <format>
        @type json
    </format>
    <inject>
        tag_key tag
        time_key date
        time_type string
        time_format %F %T
    </inject>
    <buffer []>
        @type memory
        chunk_limit_records 1
        retry_max_times 0
    </buffer>
</match>


<match stdout.** **>
    @type stdout
	
    <buffer>
	   flush_interval 1s
	</buffer>
</match>