version: '3.7'
services:
  merging_results_1:
    image: merging_results:1.5.2
    build: .
#    networks:
#      - test
    # links: fluentd:fld   it is a 'service':'alias' defining with which service it needs to be able to connect. the service name (be default) and the alias can be used as url to connect to.
    depends_on:
      - fluentd
    environment:
      - PROCESS_NAME=merging_results
      - PROCESS_VERSION=1.5.2
    env_file:
      - ./.env
    logging:
      driver: "fluentd"
      options:
        fluentd-address: host.docker.internal:24224
        tag: merging_results # docker.mergingresults.{.ID}} #docker.{.ID}  #merging_results
        fluentd-async-connect: 'true'

  merging_results_2:
    image: merging_results:1.5.2
    build: .
    depends_on:
      - fluentd
    environment:
      - PROCESS_NAME=merging_results
      - PROCESS_VERSION=1.5.2
    env_file:
      - ./.env
    logging:
      driver: "fluentd"
      options:
        fluentd-address: host.docker.internal:24224
        tag: new.dummy.tag.for.you
        fluentd-async-connect: 'true'
 
  classification_1:
    image: classification:9.1.0
    build: .
    depends_on:
      - fluentd
    environment:
      - PROCESS_NAME=classification
      - PROCESS_VERSION=9.1.0
    env_file:
      - ./.env
    logging:
      driver: "fluentd"
      options:
        fluentd-address: host.docker.internal:24224
        tag: classification
        fluentd-async-connect: "true"

#  classification_2:
#    image: classification:1.0.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=classification
#      - PROCESS_VERSION=1.0.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: classification
#
#  classification_3:
#    image: classification:1.0.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=classification
#      - PROCESS_VERSION=1.0.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: classification
#
#  assigner:
#    image: assigner:1.0.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=assigner
#      - PROCESS_VERSION=1.0.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: assigner
#
#  uploader:
#    image: uploader:1.0.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=uploader
#      - PROCESS_VERSION=1.0.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: uploader
#
#  first_process:
#    image: first_process:1.9.2
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=first_process
#      - PROCESS_VERSION=1.9.2
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: first_process
#
#  second_process:
#    image: second_process:2.2.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=second_process
#      - PROCESS_VERSION=2.2.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: second_process
#
#  third_process:
#    image: third_process:5.3.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=third_process
#      - PROCESS_VERSION=5.3.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: third_process
#
#  sumarizing_results:
#    image: sumarizing_results:1.5.2
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=sumarizing_results
#      - PROCESS_VERSION=1.5.2
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: sumarizing_results
#
#  creating_report:
#    image: creating_report:1.0.0
#    build: .
#    links:
#      - fluentd
#    environment:
#      - PROCESS_NAME=creating_report
#      - PROCESS_VERSION=1.0.0
#    env_file:
#      - ./.env
#    logging:
#      driver: "fluentd"
#      options:
#        fluentd-address: 127.0.0.1:24224
#        tag: creating_report

  fluentd:
    #image: mcrfluentd:1.0.0
    build: ./fluentd
#    networks:
#      - test   
    depends_on:
      - "elasticsearch"
    ports:
      - "24224:24224"
      - "24224:24224/udp"

  elasticsearch:
    environment:
      - "discovery.type=single-node"
#      - "ES_JAVA_OPTS=-Xms7g -Xmx7g"
#    ulimits:
#      nproc: 3000
#      nofile: 65536
#      memlock: -1
#    mem_limit: 8g
#    image: elasticsearch:5.6.14-alpine
    image: elasticsearch:7.3.0
#    networks:
#      - test
    expose:
      - 9200
    ports:
      - "9200:9200"

  kibana:
    image: kibana:7.3.0
#    networks:
#      - test
    depends_on:
      - "elasticsearch"
    ports:
      - "5601:5601"

#networks:
#  test:
#    driver: bridge